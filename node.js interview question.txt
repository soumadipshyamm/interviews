Perfect ğŸ‘ â€” hereâ€™s a **clear and short interview-style explanation** for each topic.
Use these in **technical interviews** â€” theyâ€™re crisp, to the point, and demonstrate solid understanding ğŸ‘‡

---

## âš™ï¸ **1. Modules and `require` / `import-export`**

> **Interview Answer:**
> Node.js uses modules to organize code into reusable files.
> There are two main systems:

* **CommonJS** â†’ Uses `require()` to import and `module.exports` to export.
* **ES Modules (ESM)** â†’ Uses `import` and `export` keywords, and are modern JavaScript standard modules.

âœ… *Example:*

```js
// CommonJS
const fs = require('fs');

// ES Module
import fs from 'fs';
```

> **Key difference:** CommonJS is synchronous (older system), while ES Modules are asynchronous and follow modern JS syntax.

---

## ğŸŒ **2. Global Objects**

> **Interview Answer:**
> Global objects in Node.js are available everywhere without importing.
> Some common ones:

* `console` â†’ For logging
* `process` â†’ Info about the running Node process (like environment, PID)
* `__dirname` â†’ Directory path of the current file
* `__filename` â†’ Full path of the current file
* `global` â†’ Like `window` in browser, global namespace in Node

âœ… *Example:*

```js
console.log(__dirname); 
console.log(process.env.NODE_ENV);
```

---

## ğŸ“ **3. File System Module (`fs`)**

> **Interview Answer:**
> The `fs` module is used to interact with the file system â€” reading, writing, updating, or deleting files.
> It supports both **synchronous** and **asynchronous** methods.

âœ… *Example:*

```js
const fs = require('fs');
fs.readFile('file.txt', 'utf8', (err, data) => console.log(data));
```

> **Tip:** Prefer asynchronous methods to avoid blocking the event loop.

---

## ğŸ§­ **4. Path Module (`path`)**

> **Interview Answer:**
> The `path` module helps work with file and directory paths in a platform-independent way.

âœ… *Example:*

```js
const path = require('path');
console.log(path.join(__dirname, 'folder', 'file.txt'));
```

> It handles separators automatically and provides helpers like `basename`, `dirname`, and `extname`.

---

## ğŸ’» **5. OS Module (`os`)**

> **Interview Answer:**
> The `os` module provides system-related information such as memory, CPU, and platform details.

âœ… *Example:*

```js
const os = require('os');
console.log(os.platform(), os.totalmem(), os.freemem());
```

> Commonly used to monitor system performance or display environment details.

---

## âš¡ **6. Events Module (`EventEmitter`)**

> **Interview Answer:**
> Node.js is **event-driven**. The `events` module provides the `EventEmitter` class, which lets you create and listen to custom events.

âœ… *Example:*

```js
const EventEmitter = require('events');
const emitter = new EventEmitter();

emitter.on('greet', () => console.log('Hello!'));
emitter.emit('greet');
```

> Used heavily in Nodeâ€™s core modules â€” for example, HTTP servers, streams, and sockets.

---

## ğŸŒŠ **7. Streams**

> **Interview Answer:**
> Streams are used to process data piece by piece instead of loading it all at once (helps with large files or continuous data).

There are **4 types**:

1. **Readable** â€“ For reading data
2. **Writable** â€“ For writing data
3. **Duplex** â€“ Both readable and writable
4. **Transform** â€“ Modify data as it passes through

âœ… *Example:*

```js
const fs = require('fs');
fs.createReadStream('input.txt').pipe(fs.createWriteStream('output.txt'));
```

> **Advantage:** Streams improve performance and memory efficiency.

---

## ğŸ§  **Quick Summary Table**

| Topic              | Purpose                 | Key Syntax                |
| ------------------ | ----------------------- | ------------------------- |
| **Modules**        | Organize & reuse code   | `require` / `import`      |
| **Global Objects** | Access environment info | `process`, `__dirname`    |
| **fs**             | Work with files         | `fs.readFile()`           |
| **path**           | Handle paths            | `path.join()`             |
| **os**             | System info             | `os.platform()`           |
| **events**         | Event handling          | `emitter.on()`            |
| **streams**        | Handle data flow        | `readable.pipe(writable)` |

---

Would you like me to give you a **â€œ2-minute interview revision sheetâ€** (a one-page cheat sheet with all the key definitions and sample answers)? Itâ€™s perfect before interviews.







ğŸ”¥ Here are **SUPER tricky, highly technical Node.js + MongoDB interview questions** that interviewers use to check deep understanding, not just memorization. These questions trap even experienced developers.

Iâ€™ll give **high-level tricky questions**, mixing concept + hidden edge-case logic.

---

# âœ… ğŸ”¥ **TRICKY NODE.JS QUESTIONS (Deep Level)**

---

### âœ… **1. What happens if you call `setTimeout(() => {}, 0)` inside a Promise?**

Trick: Microtasks (Promises) run before macrotasks (setTimeout), even if timeout = 0.

---

### âœ… **2. Why does this code print 3000000000 even though JavaScript canâ€™t handle 64-bit integers?**

```js
console.log(10 ** 12 * 3);
```

Reason: JS uses 64-bit floating point, not 64-bit integer. Precision loss happens, but results may â€œlook correctâ€ until threshold.

---

### âœ… **3. Why `process.nextTick()` can freeze event loop?**

Because `nextTick()` queue executes **before** microtasks and can recursively starve the loop.

---

### âœ… **4. Why synchronous crypto hashing kills Node performance?**

Because `crypto.pbkdf2Sync()` blocks **main thread**, not threadpool.

---

### âœ… **5. How many threads Node.js actually uses?**

Trick: NOT 1.

* Main thread
* Libuv threadpool (default 4 threads)
* OS threads for async FS
* V8 threads
* GC threads

---

### âœ… **6. What happens if an unhandledPromiseRejection occurs and your Node version > 15?**

Process **does NOT exit** by default â€” it logs error only. Before v15, it crashes.

---

### âœ… **7. Why Mongoose `.populate()` is slow even with indexes?**

Because `populate` runs separate queries and merges data in JS, not on Mongo engine.

---

### âœ… **8. Can you use `await` inside `forEach`? Why not?**

No â€” `forEach` doesnâ€™t await promises; it runs async code concurrently.

Expected answer: Use `for...of`.

---

### âœ… **9. What is memory leak in Node? Give a real cause.**

Example: `setInterval(() => {}, 1000)` without clearInterval, capturing closures.

---

### âœ… **10. Why a try/catch cannot catch async errors?**

Because try/catch is synchronous. Async errors must be caught with `.catch()` or `await`.

---

### âœ… **11. Why Node.js res.send() after res.json() causes error?**

Because headers already sent. Only one response allowed per request.

---

### âœ… **12. Why Object.freeze() doesn't deeply freeze in JS?**

Because it is shallow freeze. Nested objects still mutable.

---

---

# âœ… ğŸ”¥ **TRICKY MONGODB QUESTIONS (Deep Internals)**

---

### âœ… **13. Why is `db.collection.update({})` dangerous?**

Because empty filter updates **all documents**.

---

### âœ… **14. Why `$regex` search is slow even with index?**

Regex starting with wildcard `"^abc"` can use index
But `"abc"` or `".*abc"` cannot use index â†’ full scan.

---

### âœ… **15. Why Mongo skip() is slow?**

Skip() still scans skipped docs, wasting CPU + I/O.

---

### âœ… **16. Why this query is slow?**

```js
find({ status: { $ne: "active" } })
```

Because `$ne` cannot use index â†’ full collection scan.

---

### âœ… **17. How does MongoDB decide which index to use?**

It runs a **query planner** using multi-index comparison and picks lowest score route â†’ cached for future.

---

### âœ… **18. Why this aggregation fails?**

```js
$unwind: "$orders.items"
```

If some documents donâ€™t have `orders`, unwind defaults to remove them unless `"preserveNullAndEmptyArrays: true"`

---

### âœ… **19. Why ObjectId is increasing but not strictly sequential?**

ObjectId structure:

* Timestamp
* Machine ID
* Process ID
* Increment counter

So itâ€™s increasing but not purely numeric sorted.

---

### âœ… **20. Why you cannot perform transactions without replica set?**

Transactions require oplog, available only in replica sets.

---

### âœ… **21. Why Mongo deletes are slower than inserts?**

Because it checks index consistency and may need compaction during delete.

---

### âœ… **22. Why large arrays in documents kill performance?**

Because MongoDB creates multi-key indexes, exploding index size and degrading performance.

---

### âœ… **23. Why MongoDB stores numbers as double by default?**

Because BSON uses double unless manually declared as int32/int64.

---

---

# âœ… TRICKY REAL-WORLD COMBINED QUESTIONS (Node + Mongo)

---

### âœ… **24. How do you prevent race conditions when two users try to update same MongoDB document?**

Correct answer: Use `$inc`, `$addToSet`, `$push`, atomic operators OR transactions.

---

### âœ… **25. Why using Mongoose `.save()` in loops causes performance issues?**

Because `.save()` creates a separate connection round-trip per document.

Better: `insertMany()` or `bulkWrite()`.

---

### âœ… **26. Why REST API can return stale data even though Mongo writes are "successful"?**

Because write concern default is `w:1` â†’ not majority acknowledged.

---

### âœ… **27. Why calling res.json() inside transaction commit callback causes memory leak?**

Because Mongo driver returns promises inside callbacks â€” mixing callback + async style.

---

### âœ… **28. How does Node.js handle 30k simultaneous DB connections?**

It doesn't. Node handles users, not DB connections.

Correct strategy: Use a connection pool.

---

### âœ… **29. Why MongoDB findOne() returns null even when document exists?**

Because:

* Wrong readPreference (e.g., reading from secondary before replication)
* Document is not committed majority
* Projection hides fields
* Type mismatch `"1"` vs `1`

---

### âœ… **30. What is the hidden cost of using timestamps: true in mongoose?**

It adds index creation on updatedAt field â†’ slow startup on large collections.

---

---

# âœ… If you want deeper:

âœ… Detailed answers for each
âœ… Coding examples of tricky pitfalls
âœ… Whiteboard system design questions
âœ… MCQ + scenario-based test

Tell me which one you want next.





âœ… Got it. Here are **brand new, completely different, very advanced and tricky Node.js + MongoDB questions**.
These are NOT repeated from any previous list â€” all fresh, deeper, more technical, and extremely interview-focused.

---

# âœ… **ğŸ”¥ SUPER ADVANCED & TRICKY NODE.JS INTERVIEW QUESTIONS (NEW SET)**

---

## âœ… **1. What happens when you call setTimeout inside setImmediate?**

Explain execution order under different OS event-loop behaviors.

---

## âœ… **2. Why does this log 50 instead of 500?**

```js
for (var i = 0; i < 10; i++) {
  setTimeout(() => console.log(i * 5), 0);
}
```

---

## âœ… **3. Why does Node.js sometimes skip setInterval callbacks?**

Explain event loop starvation.

---

## âœ… **4. How does Node execute a Promise that contains heavy synchronous logic inside then()?**

Example:

```js
Promise.resolve().then(() => while(true){});
```

---

## âœ… **5. How does Node.js handle TCP sockets vs WebSockets?**

Explain OS kernel involvement, epoll, and libuv.

---

## âœ… **6. Why does waiting for a large file download block other routes in Express unless streamed?**

Explain synchronous buffering + RAM pressure.

---

## âœ… **7. What happens if process.nextTick() recursively calls itself?**

Explain starvation of event loop.

---

## âœ… **8. Why does worker_thread crash if you pass a huge JSON object using parentPort.postMessage()?**

Explain structured cloning algorithm.

---

## âœ… **9. Why is cluster.fork() dangerous with shared in-memory cache?**

Data inconsistency between processes.

---

## âœ… **10. What happens when a Node.js process reaches max call stack size?**

Explain stack overflow error and memory regions.

---

---

# âœ… **ğŸ”¥ SUPER ADVANCED & TRICKY MONGODB QUESTIONS (NEW SET)**

---

## âœ… **11. Why does this query return slower when filtering by "or" vs "and"?**

```js
db.users.find({
  $or: [{ age: 20 }, { city: "Delhi" }]
});
```

Explain index intersection.

---

## âœ… **12. Why does inserting documents with dynamic fields reduce performance?**

Explain lack of fixed schema â†’ fragmentation.

---

## âœ… **13. Why is $regex slow even with an index?**

Explain prefix constraint.

---

## âœ… **14. What happens if two documents produce same ObjectId timestamp at same millisecond?**

Explain per-process increment counter.

---

## âœ… **15. Why does MongoDB sometimes return documents in unexpected order even after sorting?**

Explain memory disk spill + lack of index for sort.

---

## âœ… **16. Why does $unwind on a large array crash queries?**

Explain cardinality explosion + RAM usage.

---

## âœ… **17. Why does this unique index NOT prevent duplicates?**

```js
db.users.createIndex({ email: 1 }, { unique: true, partialFilterExpression: { email: { $exists: true } } })
```

Explain documents with email null behave differently.

---

## âœ… **18. Why is $lookup slow on unsharded collections when querying a sharded cluster?**

---

## âœ… **19. Why does updateMany on large collection block writes temporarily?**

Explain collection-level locking during metadata changes.

---

## âœ… **20. What happens when your MongoDB aggregation pipeline exceeds 100MB memory limit?**

Disk spill â†’ temporary files â†’ slow.

---

---

# âœ… **ğŸ”¥ COMBINED NODE.JS + MONGODB REAL-WORLD TRICKY QUESTIONS (NEW SET)**

---

## âœ… **21. How does Node.js handle MongoDB connection pooling under high concurrency?**

Explain maxPoolSize, minPoolSize, waitQueueTimeout.

---

## âœ… **22. Why does transaction performance degrade in a replica set?**

Explain oplog blocking + write concern majority.

---

## âœ… **23. How does MongoDB handle writes when a replica set election occurs?**

Temporary write freeze, primary unavailable.

---

## âœ… **24. Why do large JSON responses slow down Node.js?**

Explain:

* Serialization cost
* Chunked transfer
* RAM buffer

---

## âœ… **25. Why does increasing PM2 cluster workers sometimes REDUCE performance?**

Because MongoDB connection pool gets saturated.

---

## âœ… **26. Why does this code lead to race conditions?**

```js
const user = await User.findById(id);
user.balance += amount;
await user.save();
```

---

## âœ… **27. How to guarantee atomic decrement of stock?**

Use:

```js
$inc: { stock: -1 }
```

inside transaction or optimistic lock.

---

## âœ… **28. Why does high CPU usage spike when converting MongoDB large aggregation result into JavaScript objects?**

Explain BSON â†’ JS conversion overhead.

---

## âœ… **29. Why do Node streams sometimes emit "Unhandled 'error' event"?**

Missing error listeners â†’ default throw.

---

## âœ… **30. Why does your API freeze when 1 request is doing bcrypt.hashSync()?**

Explain synchronous CPU bound.

---

---

# âœ… If you want, I can generate:

ğŸ”¥ 50 more questions
ğŸ”¥ Only tricky coding questions
ğŸ”¥ Real-world scenario case studies
ğŸ”¥ Questions with answers
ğŸ”¥ Multiple-choice + explanations
ğŸ”¥ Interview cheat sheet

Tell me what type you want next.





ğŸ”¥ **Here are extremely advanced REAL-WORLD Node.js + MongoDB scenario-based interview case studies**
These force you to think like a senior engineer solving actual production failures, race conditions, scaling issues, and architectural traps.

All problems are designed exactly like **FAANG + high-level startup interviews**.

---

# âœ… **ğŸ”¥ CASE STUDY 1 â€” Race Condition in Payment System**

### ğŸ’¥ Problem

You have a wallet system:

```js
wallet.balance += 100;
await wallet.save();
```

Users rapidly call the API â†’ double credits, negative balance issues.

### â“ Interviewer asks:

* Whatâ€™s the exact bug?
* How do you fix it?
* How to guarantee idempotency?

### âœ… Expected answer direction:

* Race condition between read + write
* Use atomic `$inc`, transactions, unique tokens
* Use idempotency keys
* Locking (pessimistic with Redis or optimistic using `versionKey`)

---

# âœ… **ğŸ”¥ CASE STUDY 2 â€” MongoDB High CPU Usage After Deploy**

### ğŸ’¥ Problem

After deploying a new version, MongoDB CPU goes 90%+
Dashboard queries become extremely slow.

### ğŸ¤” What changed?

You added:

```js
User.find({ email: { $regex: searchTerm } })
```

### â“ Interviewer asks:

* Why is CPU spiking?
* Why is index not used?
* Whatâ€™s the proper fix?

### âœ… Expected answer direction:

* Regex without prefix â†’ full collection scan
* Create a text index / prefix regex
* Use `$regex: '^search'` OR `$text: { $search: ... }`
* Use a separate search engine (Elastic)

---

# âœ… **ğŸ”¥ CASE STUDY 3 â€” Node.js Event Loop Blocking**

### ğŸ’¥ Problem

One route blocks all other requests:

```js
app.get('/report', (req, res) => {
  const data = bcrypt.hashSync("password", 15);
  res.send("Done");
});
```

### â“ Interviewer asks:

* What happens internally?
* Why are other endpoints slow?
* How to fix?

### âœ… Expected answer direction:

* CPU-bound synchronous call blocks event loop
* Move heavy compute to worker_threads / asynchronous hashing
* Horizontal scaling

---

# âœ… **ğŸ”¥ CASE STUDY 4 â€” MongoDB Duplicate Orders Under High Load**

### ğŸ’¥ Problem

Millions of order placements â†’ duplicate order creation.

### â“ Interviewer asks:

* Why do duplicates occur?
* Does MongoDB write concern fix it?
* Whatâ€™s the best prevention?

### âœ… Expected answer direction:

* Two parallel requests cause duplicate insert
* Unique index on orderId
* Use transactions + distributed locks
* Retry mechanism on duplicate key error

---

# âœ… **ğŸ”¥ CASE STUDY 5 â€” API Suddenly Crashes With â€œheap out of memoryâ€**

### ğŸ’¥ Problem

Logs show:

```
JavaScript heap out of memory
```

Code:

```js
const users = await User.find({});
```

### â“ Interviewer asks:

* What caused the crash?
* Why did GC fail?
* How to fix?

### âœ… Expected answer direction:

* Loading entire DB into RAM
* Pagination
* Use cursor/stream
* Use projection
* Avoid huge JSON stringify

---

# âœ… **ğŸ”¥ CASE STUDY 6 â€” Slow Aggregation Pipeline in Production**

### ğŸ’¥ Problem

Aggregation takes 5+ seconds after adding a $lookup.

### â“ Interviewer asks:

* Why did $lookup slow it down?
* How to optimize?

### âœ… Expected answer direction:

* Lookup with billions of documents
* Add index on foreignField
* Move to pipeline stage early
* Use `pipeline` lookup not legacy localField/foreignField
* Use sharding mapping

---

# âœ… **ğŸ”¥ CASE STUDY 7 â€” Lost WebSocket Messages in Clustered Setup**

### ğŸ’¥ Problem

Socket.io messages not reaching all clients after enabling PM2 cluster.

### â“ Interviewer asks:

* Why does clustering break WebSockets?
* How to fix global message distribution?

### âœ… Expected answer direction:

* Each worker has separate memory
* Use Redis adapter for socket.io

```
const { createAdapter } = require('@socket.io/redis-adapter');
```

---

# âœ… **ğŸ”¥ CASE STUDY 8 â€” High Database Connections Usage**

### ğŸ’¥ Problem

MongoDB shows 5,000+ connections. Server slows down.

### â“ Interviewer asks:

* Why are connections leaking?
* How to fix?

### âœ… Expected answer direction:

* New connection created on every API request
* Use global connection pool
* Disable keepAlive false
* Use single mongoose.connect() per app

---

# âœ… **ğŸ”¥ CASE STUDY 9 â€” Query Returns Wrong Results After Sharding**

### ğŸ’¥ Problem

After sharding a collection, some queries return incomplete results.

### â“ Interviewer asks:

* Why?
* How to fix?

### âœ… Expected answer direction:

* Query not including shard key
* Mongos doesnâ€™t route correctly
* Add shard key condition
* Reshard if needed

---

# âœ… **ğŸ”¥ CASE STUDY 10 â€” Server Stalls During File Uploads**

### ğŸ’¥ Problem

Users report slow uploads. API hangs.

### â“ Interviewer asks:

* Why is Express freezing?
* How to fix huge file upload handling?

### âœ… Expected answer direction:

* BodyParser buffering whole file
* Must use streaming + multer + S3 signed URLs
* Avoid storing in memory

---

# âœ… **ğŸ”¥ CASE STUDY 11 â€” Large Aggregation Pipeline Exceeds Memory Limit**

### ğŸ’¥ Problem

Aggregation fails:

```
Exceeded memory limit for $group
```

### â“ Interviewer asks:

* Why?
* How to fix?

### âœ… Expected answer direction:

* 100MB limit
* Use `allowDiskUse: true`
* Add indexes
* Move $match early
* Reduce cardinality

---

# âœ… **ğŸ”¥ CASE STUDY 12 â€” Node.js Server CPU Spikes Under Load**

### ğŸ’¥ Problem

During stress test, CPU hits 100% even though API is mostly I/O based.

### â“ Interviewer asks:

* Why?
* What tools to diagnose?

### âœ… Expected answer direction:

* Hidden CPU tasks (JSON parsing, encryption, compression)
* Use `clinic.js`, `node --prof`, flame graph
* Offload heavy tasks

---

# âœ… **ğŸ”¥ CASE STUDY 13 â€” Lost Data After Restarting Node Server**

### ğŸ’¥ Problem

In-memory cache lost after restart â†’ wrong totals.

### â“ Interviewer asks:

* Why did this happen?
* Best solution?

### âœ… Expected answer direction:

* Memory cache not persistent
* Use Redis/Memcached
* Persistent layer required

---

# âœ… **ğŸ”¥ CASE STUDY 14 â€” Timezone Bug in Reports**

### ğŸ’¥ Problem

Dates off by 5.5 hours in India.

### â“ Interviewer asks:

* Why?
* How fix?

### âœ… Expected answer direction:

* MongoDB stores UTC
* Node prints local timezone differently
* Use moment-timezone or Day.js
* Convert UTC at API output stage

---

# âœ… **ğŸ”¥ CASE STUDY 15 â€” Deadlock in Transaction**

### ğŸ’¥ Problem

Two microservices using MongoDB transactions â†’ deadlock.

### â“ Interviewer asks:

* Why deadlock occurs?
* How to prevent?

### âœ… Expected answer direction:

* Opposite lock order
* Retry transaction
* Use consistent ordering
* Split batch operations

---

---

# âœ… Want more?

âœ… 15 more ultra-advanced scenarios
âœ… Scenarios with code + solution
âœ… Tricky multiple-choice version
âœ… Full answer key

Tell me what next.
